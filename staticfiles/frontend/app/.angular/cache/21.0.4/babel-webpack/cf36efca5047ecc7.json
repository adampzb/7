{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { environment } from '@discussit/env/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@discussit/core/services/comment/comment.service\";\nimport * as i2 from \"@discussit/core/services/user/user.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/progress-spinner\";\nimport * as i7 from \"../comment-create/comment-create.component\";\nimport * as i8 from \"../comment-list/comment-list.component\";\nfunction CommentGroupComponent_ng_container_1_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"p\", 8);\n    i0.ɵɵtext(2, \"Please \\u00A0 \");\n    i0.ɵɵelementStart(3, \"a\", 9);\n    i0.ɵɵlistener(\"click\", function CommentGroupComponent_ng_container_1_div_3_Template_a_click_3_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.goToLogin());\n    });\n    i0.ɵɵtext(4, \"Login \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5, \"\\u00A0 or \\u00A0\");\n    i0.ɵɵelementStart(6, \"a\", 9);\n    i0.ɵɵlistener(\"click\", function CommentGroupComponent_ng_container_1_div_3_Template_a_click_6_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.goToLogin());\n    });\n    i0.ɵɵtext(7, \"Sign up \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8, \"\\u00A0 to add comments \");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CommentGroupComponent_ng_container_1_section_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"section\", 10)(1, \"app-comment-list\", 11);\n    i0.ɵɵlistener(\"mentioned\", function CommentGroupComponent_ng_container_1_section_4_Template_app_comment_list_mentioned_1_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.userMentioned($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"comments\", ctx_r1.comments)(\"user\", ctx_r1.user)(\"uuid\", ctx_r1.uuid)(\"max_nest_depth\", ctx_r1.max_nest_depth)(\"current_nest_depth\", ctx_r1.current_nest_depth);\n  }\n}\nfunction CommentGroupComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"section\", 3)(2, \"app-comment-create\", 4);\n    i0.ɵɵlistener(\"comment_response\", function CommentGroupComponent_ng_container_1_Template_app_comment_create_comment_response_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.created($event));\n    })(\"remove_mention\", function CommentGroupComponent_ng_container_1_Template_app_comment_create_remove_mention_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.removeMention($event));\n    })(\"clear_comment\", function CommentGroupComponent_ng_container_1_Template_app_comment_create_clear_comment_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.clearComment($event));\n    });\n    i0.ɵɵtemplate(3, CommentGroupComponent_ng_container_1_div_3_Template, 9, 0, \"div\", 5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(4, CommentGroupComponent_ng_container_1_section_4_Template, 2, 5, \"section\", 6);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"user\", ctx_r1.user)(\"uuid\", ctx_r1.uuid)(\"mentioned_users\", ctx_r1.mentioned_users)(\"nested\", ctx_r1.nested && ctx_r1.current_nest_depth < ctx_r1.max_nest_depth)(\"parent\", ctx_r1.parent)(\"child_group\", ctx_r1.child_group);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.is_authenticated);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.comments);\n  }\n}\nfunction CommentGroupComponent_ng_container_2_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 13);\n    i0.ɵɵelement(2, \"mat-spinner\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"diameter\", 20);\n  }\n}\nfunction CommentGroupComponent_ng_container_2_ng_template_2_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function CommentGroupComponent_ng_container_2_ng_template_2_div_0_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.loadMoreComments());\n    });\n    i0.ɵɵtext(2, \"Load more comments\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction CommentGroupComponent_ng_container_2_ng_template_2_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 19);\n  }\n}\nfunction CommentGroupComponent_ng_container_2_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, CommentGroupComponent_ng_container_2_ng_template_2_div_0_Template, 3, 0, \"div\", 15)(1, CommentGroupComponent_ng_container_2_ng_template_2_div_1_Template, 1, 0, \"div\", 16);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.next);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.next && ctx_r1.comments_count > 0 && !ctx_r1.child_group);\n  }\n}\nfunction CommentGroupComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CommentGroupComponent_ng_container_2_ng_container_1_Template, 3, 1, \"ng-container\", 12)(2, CommentGroupComponent_ng_container_2_ng_template_2_Template, 2, 2, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const nextButton_r6 = i0.ɵɵreference(3);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.showLoader)(\"ngIfElse\", nextButton_r6);\n  }\n}\nexport let CommentGroupComponent = /*#__PURE__*/(() => {\n  class CommentGroupComponent {\n    constructor(commentService, userService, router) {\n      this.commentService = commentService;\n      this.userService = userService;\n      this.router = router;\n      this.comments = [];\n      this.create_only = false;\n      this.max_nest_depth = 0;\n      this.current_nest_depth = 0;\n      this.child_group = false;\n      this.commentable = true;\n      this.next = null;\n      this.page = 1;\n      this.is_authenticated = false;\n      this.comments_count = 0;\n      this.user_checked = false;\n      this.mentioned_users = new Set();\n      this.showLoader = false;\n      this.counter = new EventEmitter();\n      this.create_only_toggle = new EventEmitter();\n      this.nested = true;\n      this.loginUrl = `${environment.loginUrl}/`;\n    }\n    ngOnInit() {\n      this.showLoader = true;\n      if (this.user) {\n        this.is_authenticated = true;\n      } else {\n        this.getUser();\n      }\n      this.getComments();\n    }\n    getUser() {\n      this.userService.userInitialized.subscribe(initialized => {\n        if (initialized) {\n          this.userService.user.subscribe(user => {\n            if (user) {\n              this.user = user;\n              console.log(this.user);\n              this.user_checked = true;\n              this.is_authenticated = true;\n            } else {\n              this.user_checked = true;\n              this.is_authenticated = false;\n            }\n          });\n        }\n      });\n    }\n    getComments() {\n      this.commentService.getComments(this.uuid, this.page, this.child_group, this.parent).subscribe(response => {\n        this.showLoader = false;\n        this.setComments(response);\n      }, err => {\n        console.log(err);\n        this.showLoader = false;\n      });\n    }\n    loadMoreComments() {\n      if (this.next != null) {\n        this.getComments();\n      }\n    }\n    setComments(response) {\n      this.next = response.next;\n      if (this.next) {\n        this.page = parseInt(this.next.split('=')[1]);\n      }\n      this.comments = [...this.comments, ...response.results];\n      this.comments_count = response.count;\n    }\n    created(data) {\n      this.comments.unshift(data);\n      this.create_only = false;\n      this.counter.emit(this.comments.length);\n    }\n    goToLogin() {\n      // window.location.href = `${this.loginUrl}&continue=${window.location.href}`;\n      this.router.navigate(['sign-in']);\n    }\n    userMentioned(data) {\n      if (this.mentioned_users.size === 0) {\n        this.mentioned_users.add(data);\n      } else {\n        let user_found = false;\n        this.mentioned_users.forEach(user => {\n          if (data.id === user.id) {\n            user_found = true;\n            // this.mentioned_users.add(data);\n          }\n        });\n        if (!user_found) {\n          this.mentioned_users.add(data);\n        }\n      }\n      // console.log(this.mentioned_users);\n      this.scrollToCreate();\n    }\n    removeMention(data) {\n      if (this.mentioned_users.has(data)) {\n        this.mentioned_users.delete(data);\n      }\n    }\n    clearComment(data) {\n      this.mentioned_users.clear();\n    }\n    scrollToCreate() {\n      const el = document.getElementById('createsection');\n      el.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n    static {\n      this.ɵfac = function CommentGroupComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CommentGroupComponent)(i0.ɵɵdirectiveInject(i1.CommentService), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CommentGroupComponent,\n        selectors: [[\"app-comment-group\"]],\n        inputs: {\n          uuid: \"uuid\",\n          create_only: \"create_only\",\n          user: \"user\",\n          max_nest_depth: \"max_nest_depth\",\n          current_nest_depth: \"current_nest_depth\",\n          parent: \"parent\",\n          child_group: \"child_group\",\n          commentable: \"commentable\"\n        },\n        outputs: {\n          counter: \"counter\",\n          create_only_toggle: \"create_only_toggle\"\n        },\n        standalone: false,\n        decls: 3,\n        vars: 2,\n        consts: [[\"nextButton\", \"\"], [1, \"app-comment-section\"], [4, \"ngIf\"], [\"id\", \"createsection\", 1, \"comment-create\", 2, \"margin-bottom\", \"16px\"], [2, \"height\", \"170px\", 3, \"comment_response\", \"remove_mention\", \"clear_comment\", \"user\", \"uuid\", \"mentioned_users\", \"nested\", \"parent\", \"child_group\"], [\"commentPlaceholder\", \"\", 4, \"ngIf\"], [\"class\", \"comment-list\", \"style\", \"height:100%\", 4, \"ngIf\"], [\"commentPlaceholder\", \"\"], [1, \"comment-header\", \"font-xs\"], [1, \"link\", 3, \"click\"], [1, \"comment-list\", 2, \"height\", \"100%\"], [3, \"mentioned\", \"comments\", \"user\", \"uuid\", \"max_nest_depth\", \"current_nest_depth\"], [4, \"ngIf\", \"ngIfElse\"], [\"fxLayoutAlign\", \"center center\", 2, \"height\", \"200px\"], [\"color\", \"warn\", 3, \"diameter\"], [\"fxLayoutAlign\", \"center center\", \"style\", \"margin-top:30px; padding-bottom:30px;\", 4, \"ngIf\"], [\"class\", \"\", \"fxLayoutAlign\", \"center center\", 4, \"ngIf\"], [\"fxLayoutAlign\", \"center center\", 2, \"margin-top\", \"30px\", \"padding-bottom\", \"30px\"], [\"mat-flat-button\", \"\", 3, \"click\"], [\"fxLayoutAlign\", \"center center\", 1, \"\"]],\n        template: function CommentGroupComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"section\", 1);\n            i0.ɵɵtemplate(1, CommentGroupComponent_ng_container_1_Template, 5, 8, \"ng-container\", 2)(2, CommentGroupComponent_ng_container_2_Template, 4, 2, \"ng-container\", 2);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.user_checked || ctx.is_authenticated && ctx.commentable);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.create_only);\n          }\n        },\n        dependencies: [i4.NgIf, i5.MatButton, i6.MatProgressSpinner, i7.CommentCreateComponent, i8.CommentListComponent],\n        styles: [\".separator-icon[_ngcontent-%COMP%]{font-size:60px;height:60px;color:#707070;text-align:center;width:auto;display:block}.comment-header[_ngcontent-%COMP%]{width:100%;padding:8px 12px;font-size:14px}.link[_ngcontent-%COMP%]{font-weight:500;color:brown;font-size:14px}\"]\n      });\n    }\n  }\n  return CommentGroupComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}