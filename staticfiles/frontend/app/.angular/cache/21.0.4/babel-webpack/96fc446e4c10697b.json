{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@discussit/core/services/comment/comment.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/material/button\";\nimport * as i5 from \"@angular/material/input\";\nimport * as i6 from \"@angular/cdk/text-field\";\nfunction CommentEditComponent_div_0_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function CommentEditComponent_div_0_button_10_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.cancel());\n    });\n    i0.ɵɵtext(1, \"Cancel\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction CommentEditComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2);\n    i0.ɵɵelement(2, \"img\", 3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 4)(4, \"form\", 5)(5, \"div\", 6)(6, \"div\", 7)(7, \"textarea\", 8);\n    i0.ɵɵtext(8, \"          \");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"div\", 9);\n    i0.ɵɵtemplate(10, CommentEditComponent_div_0_button_10_Template, 2, 0, \"button\", 10);\n    i0.ɵɵelementStart(11, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function CommentEditComponent_div_0_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.submit());\n    });\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.commentForm);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.commentForm.valid);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r2.comment_loading);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.new ? \"Comment\" : \"Save\");\n  }\n}\nexport let CommentEditComponent = /*#__PURE__*/(() => {\n  class CommentEditComponent {\n    constructor(commentService) {\n      this.commentService = commentService;\n      this.new = true;\n      this.nested = false;\n      this.child_group = false;\n      this.comment_response = new EventEmitter();\n      this.remove_mention = new EventEmitter();\n      this.clear_comment = new EventEmitter();\n      this.mentioned_user_ids = [];\n      this.comment_loading = false;\n    }\n    ngOnInit() {\n      this.initiateCommentForm();\n      // console.log(this.source, \"comment-create\");\n    }\n    get f() {\n      return this.commentForm.controls;\n    }\n    initiateCommentForm() {\n      let comment_string = '';\n      if (this.comment_obj) {\n        comment_string = this.comment_obj.comment;\n      }\n      this.commentForm = new FormGroup({\n        comment: new FormControl(comment_string, {\n          validators: [Validators.required, Validators.minLength(2), Validators.maxLength(2000)]\n        })\n      });\n      // console.log(this.mentioned_users);\n    }\n    submit() {\n      console.log('Comment submit clicked');\n      console.log('Form valid:', this.commentForm.valid);\n      console.log('Form value:', this.commentForm.value);\n      console.log('Form errors:', this.commentForm.errors);\n      if (this.commentForm.invalid) {\n        console.log('Form is invalid, not submitting');\n        console.log('Comment control errors:', this.commentForm.get('comment')?.errors);\n        console.log('Comment value length:', this.commentForm.value.comment?.length);\n        return;\n      }\n      let id = null;\n      if (!this.new) {\n        id = this.comment_obj.id;\n      }\n      if (this.new && this.mentioned_users && this.mentioned_users.size > 0) {\n        this.mentioned_users.forEach(user => {\n          this.mentioned_user_ids.push(user.id);\n        });\n      }\n      // console.log(this.mentioned_user_ids);\n      let comment = {\n        id: id,\n        comment: this.commentForm.value.comment,\n        user: this.user.id,\n        mentioned_users: this.mentioned_user_ids,\n        is_nesting_permitted: this.nested\n      };\n      if (this.child_group) {\n        comment['parent'] = this.parent;\n      }\n      if (this.new) {\n        this.createComment(comment);\n      } else {\n        this.updateComment(comment);\n      }\n    }\n    cancel() {\n      if (this.new) {\n        this.commentForm.reset(this.commentForm.value.comment);\n        this.clear_comment.emit(true);\n      } else {\n        this.comment_response.emit(this.comment_obj);\n      }\n    }\n    createComment(comment) {\n      console.log('Creating comment with data:', comment);\n      console.log('Post UUID:', this.uuid);\n      this.commentForm.reset(this.commentForm.value.comment);\n      this.clear_comment.emit(true);\n      this.comment_loading = true;\n      this.commentService.createComment(this.uuid, comment).subscribe(response => {\n        console.log('Comment created successfully:', response);\n        this.comment_loading = false;\n        this.comment_response.emit(response);\n        this.clear_comment.emit(true);\n        this.mentioned_user_ids.length = 0;\n      }, err => {\n        console.error('Error creating comment:', err);\n        console.error('Error details:', err.error);\n        this.comment_loading = false;\n      });\n    }\n    updateComment(comment) {\n      this.commentService.updateComment(this.uuid, comment.id, comment).subscribe(response => {\n        // console.log(response);\n        this.comment_response.emit(response);\n      }, err => {\n        console.log(err);\n      });\n    }\n    removeMention(user) {\n      this.remove_mention.emit(user);\n    }\n    static {\n      this.ɵfac = function CommentEditComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || CommentEditComponent)(i0.ɵɵdirectiveInject(i1.CommentService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: CommentEditComponent,\n        selectors: [[\"app-comment-edit\"]],\n        inputs: {\n          user: \"user\",\n          uuid: \"uuid\",\n          new: \"new\",\n          comment_obj: \"comment_obj\",\n          mentioned_users: \"mentioned_users\",\n          nested: \"nested\",\n          parent: \"parent\",\n          child_group: \"child_group\"\n        },\n        outputs: {\n          comment_response: \"comment_response\",\n          remove_mention: \"remove_mention\",\n          clear_comment: \"clear_comment\"\n        },\n        standalone: false,\n        decls: 1,\n        vars: 1,\n        consts: [[\"fxLayout\", \"row\", \"class\", \"width-100\", \"style\", \"margin-bottom:50px; gap: 12px;\", 4, \"ngIf\"], [\"fxLayout\", \"row\", 1, \"width-100\", 2, \"margin-bottom\", \"50px\", \"gap\", \"12px\"], [\"fxLayout\", \"column\", \"fxFlex\", \"50px\", 1, \"col-user\"], [\"src\", \"/static/assets/images/default_user.png\", \"alt\", \"\", 1, \"user-avatar\"], [\"fxLayout\", \"column\", \"fxFlex\", \"90\", 2, \"margin\", \"auto\"], [1, \"width-100\", 3, \"formGroup\"], [1, \"comment-wrapper\"], [1, \"width-100\", \"comment-input-field\"], [\"matInput\", \"\", \"formControlName\", \"comment\", \"maxlength\", \"2000\", \"placeholder\", \"Comment\", \"cdkTextareaAutosize\", \"\", \"cdkAutosizeMaxRows\", \"3\", \"cdkAutosizeMinRows\", \"3\", 1, \"font-sm\", \"sparro-grey-800\", \"comment-textbox\"], [\"fxLayout\", \"row\", \"fxLayoutGap\", \"16px\", 2, \"justify-content\", \"flex-end\"], [\"mat-flat-button\", \"\", 3, \"click\", 4, \"ngIf\"], [\"mat-flat-button\", \"\", 3, \"click\", \"disabled\"], [\"mat-flat-button\", \"\", 3, \"click\"]],\n        template: function CommentEditComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, CommentEditComponent_div_0_Template, 13, 4, \"div\", 0);\n          }\n          if (rf & 2) {\n            i0.ɵɵproperty(\"ngIf\", ctx.user);\n          }\n        },\n        dependencies: [i2.NgIf, i3.ɵNgNoValidate, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.MaxLengthValidator, i3.FormGroupDirective, i3.FormControlName, i4.MatButton, i5.MatInput, i6.CdkTextareaAutosize],\n        styles: [\".comment-form[_ngcontent-%COMP%]   .mat-primary[_ngcontent-%COMP%]{color:#707070}.mention-list[_ngcontent-%COMP%]{float:left;width:60px;margin:5px}.comment-form.mat-form-field-appearance-outline[_ngcontent-%COMP%]   .mat-form-field-outline-start[_ngcontent-%COMP%]{border-radius:8px 0 0 8px!important}.comment-form.mat-form-field-appearance-outline[_ngcontent-%COMP%]   .mat-form-field-outline-end[_ngcontent-%COMP%]{border-radius:0 8px 8px 0!important}.comment-form.mat-form-field-appearance-outline.mat-form-field-invalid.mat-form-field-invalid[_ngcontent-%COMP%]   .mat-form-field-outline-thick[_ngcontent-%COMP%]{color:#707070!important}  .mat-form-field-wrapper{padding-bottom:0!important}  .mat-form-field-infix{border-top:0}@media(max-width:640px){.col-user[_ngcontent-%COMP%]{max-width:15%!important}}  .comment-input-field .mat-form-field-wrapper{padding-bottom:0!important}  .comment-input-field .mat-form-field-appearance-outline .mat-form-field-outline{color:transparent!important}  .comment-input-field .mat-form-field-infix{border-top:0!important}[_ngcontent-%COMP%]::placeholder{font-size:14px;font-family:Roboto,sans-serif}.comment-wrapper[_ngcontent-%COMP%]{border:1px solid #d3d3d3;border-radius:8px;padding:8px;margin-bottom:16px}.comment-textbox[_ngcontent-%COMP%]{font-size:14px;font-family:Roboto,sans-serif;width:100%;line-height:22px;outline:none;border:none;margin-top:8px}.commentbox-container[_ngcontent-%COMP%]{gap:24px}@media only screen and (max-width:960px){.commentbox-container[_ngcontent-%COMP%]{gap:12px}}[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px;overflow-y:scroll;box-shadow:inset 0 0 4px #929292;border-radius:15px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#f15a24;border-radius:10px}\"]\n      });\n    }\n  }\n  return CommentEditComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}