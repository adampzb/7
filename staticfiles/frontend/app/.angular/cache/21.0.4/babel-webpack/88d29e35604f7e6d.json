{"ast":null,"code":"import { environment } from '@discussit/env/environment';\nimport { FormGroup, FormControl } from '@angular/forms';\nimport { NavigationEnd } from '@angular/router';\nimport { CreateGroupComponent } from './group/create-group/create-group.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"./core/services/user/user.service\";\nimport * as i3 from \"ngx-cookie-service\";\nimport * as i4 from \"./core/services/storage/storage-handler.service\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/common/http\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"@angular/material/button\";\nimport * as i10 from \"@angular/material/icon\";\nimport * as i11 from \"@angular/material/toolbar\";\nconst _c0 = (a0, a1) => ({\n  \"bg-container\": a0,\n  \"app-main\": a1\n});\nconst _c1 = a0 => ({\n  \"unauth-container\": a0\n});\nconst _c2 = () => [\"\"];\nconst _c3 = () => [\"create\"];\nconst _c4 = () => [\"all_groups\"];\nconst _c5 = a0 => [\"user\", a0];\nconst _c6 = () => [\"sign-in\"];\nfunction AppComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \\u2705 Angular App is Working! User: \", (ctx_r0.user == null ? null : ctx_r0.user.username) || \"Not logged in\", \" - Time: \", ctx_r0.currentTime, \" \");\n  }\n}\nfunction AppComponent_mat_toolbar_2_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"a\", 19);\n    i0.ɵɵtext(2, \" Create post \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"a\", 20);\n    i0.ɵɵlistener(\"click\", function AppComponent_mat_toolbar_2_ng_container_5_Template_a_click_3_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.createGroup());\n    });\n    i0.ɵɵtext(4, \" Create group \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"a\", 19);\n    i0.ɵɵtext(6, \" All groups \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(2, _c3));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(3, _c4));\n  }\n}\nfunction AppComponent_mat_toolbar_2_ng_container_12_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 22)(1, \"a\", 23)(2, \"mat-icon\");\n    i0.ɵɵtext(3, \"person\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"span\", 24);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 25);\n    i0.ɵɵlistener(\"click\", function AppComponent_mat_toolbar_2_ng_container_12_div_1_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r0 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r0.logout());\n    });\n    i0.ɵɵelementStart(7, \"mat-icon\");\n    i0.ɵɵtext(8, \"logout\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(2, _c5, ctx_r0.user.username));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r0.user == null ? null : ctx_r0.user.username);\n  }\n}\nfunction AppComponent_mat_toolbar_2_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, AppComponent_mat_toolbar_2_ng_container_12_div_1_Template, 9, 4, \"div\", 21);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user);\n  }\n}\nfunction AppComponent_mat_toolbar_2_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"a\", 27);\n    i0.ɵɵtext(2, \"Login\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(1, _c6));\n  }\n}\nfunction AppComponent_mat_toolbar_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-toolbar\", 8)(1, \"div\", 9);\n    i0.ɵɵelement(2, \"img\", 10);\n    i0.ɵɵelementStart(3, \"a\", 11);\n    i0.ɵɵtext(4, \" DiscussIt \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, AppComponent_mat_toolbar_2_ng_container_5_Template, 7, 4, \"ng-container\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 13)(7, \"form\", 14);\n    i0.ɵɵlistener(\"ngSubmit\", function AppComponent_mat_toolbar_2_Template_form_ngSubmit_7_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.search());\n    });\n    i0.ɵɵelementStart(8, \"button\", 15)(9, \"mat-icon\", 16);\n    i0.ɵɵtext(10, \"search\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(11, \"input\", 17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, AppComponent_mat_toolbar_2_ng_container_12_Template, 2, 1, \"ng-container\", 18)(13, AppComponent_mat_toolbar_2_ng_template_13_Template, 3, 2, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const elseTemplate_r5 = i0.ɵɵreference(14);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(5, _c2));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.searchField);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user)(\"ngIfElse\", elseTemplate_r5);\n  }\n}\nfunction AppComponent_footer_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"footer\", 28);\n    i0.ɵɵtext(1, \" Terms of policy . Privacy policy . Copyright @ 2025 . \");\n    i0.ɵɵelementStart(2, \"a\", 29);\n    i0.ɵɵtext(3, \"Adam P.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(router, userService, cookieService, storage, dialog, http) {\n      this.router = router;\n      this.userService = userService;\n      this.cookieService = cookieService;\n      this.storage = storage;\n      this.dialog = dialog;\n      this.http = http;\n      this.title = 'discussit';\n      this.authRoute = false;\n      this.value = 'Search';\n      this.router.events.subscribe(event => {\n        this.path = this.router.url;\n        // Refresh user state when navigating away from auth routes\n        if (event instanceof NavigationEnd) {\n          const wasAuthRoute = this.authRoute;\n          this.authRoute = this.path.includes('sign-in') || this.path.includes('sign-up');\n          // If we just left an auth route, refresh user state\n          if (wasAuthRoute && !this.authRoute) {\n            console.log('Left auth route, refreshing user state');\n            this.refreshUserState();\n          }\n        }\n      });\n      this.path = this.router.url;\n    }\n    ngOnInit() {\n      console.log('AppComponent ngOnInit called');\n      this.currentTime = new Date().toLocaleTimeString();\n      this.searchField = new FormGroup({\n        search: new FormControl('')\n      });\n      // Test API connectivity\n      this.testApiConnectivity();\n      // Subscribe to user changes\n      this.userService.user?.subscribe(user => {\n        console.log('User state changed:', user);\n        this.user = user;\n      });\n      // Add error handling to prevent initialization issues\n      try {\n        this.userService.fetchUser(user => {\n          console.log('User fetched:', user);\n          this.user = user;\n        });\n      } catch (error) {\n        console.error('Error fetching user:', error);\n        this.user = null;\n      }\n    }\n    testApiConnectivity() {\n      console.log('Testing API connectivity...');\n      // Test a simple GET request to see if the API is reachable\n      const testUrl = `${environment.serverUrl}${environment.baseUrl}posts/`;\n      console.log('Testing API URL:', testUrl);\n      this.http.get(testUrl).subscribe(response => {\n        console.log('✅ API connectivity test successful:', response);\n      }, error => {\n        console.error('❌ API connectivity test failed:', error);\n      });\n    }\n    refreshUserState() {\n      console.log('Refreshing user state...');\n      try {\n        this.userService.fetchUser(user => {\n          console.log('User state refreshed:', user);\n          this.user = user;\n        });\n      } catch (error) {\n        console.error('Error refreshing user state:', error);\n      }\n    }\n    ngAfterContentChecked() {\n      if (this.path.includes('/sign-in') || this.path.includes('/sign-up') || this.path.includes('logout')) {\n        this.authRoute = true;\n      } else {\n        this.authRoute = false;\n      }\n    }\n    logout() {\n      console.log('Logout button clicked');\n      this.userService.logout().subscribe(response => {\n        console.log('Logout response:', response);\n        // Clear user data and auth token\n        this.storage.removeItem('user');\n        localStorage.removeItem('auth_token');\n        this.userService.unsetUser();\n        this.user = null;\n        window.location.href = `${environment.loginUrl}`;\n      }, error => {\n        console.log('Logout error:', error);\n        // Even if logout fails on server, clear local data\n        this.storage.removeItem('user');\n        localStorage.removeItem('auth_token');\n        this.userService.unsetUser();\n        this.user = null;\n        window.location.href = `${environment.loginUrl}`;\n      });\n    }\n    createGroup() {\n      console.log('Create group button clicked');\n      const dialogRef = this.dialog.open(CreateGroupComponent, {\n        data: {\n          user: this.user\n        },\n        width: '600px',\n        minHeight: '300px'\n      });\n      dialogRef.afterClosed().subscribe(result => {\n        console.log(`Dialog result: ${result}`);\n      });\n    }\n    search() {\n      console.log('Search button clicked');\n      this.router.navigate(['search'], {\n        queryParams: {\n          query: this.searchField.value.search\n        }\n      });\n      this.searchField.reset();\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AppComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.CookieService), i0.ɵɵdirectiveInject(i4.StorageHandlerService), i0.ɵɵdirectiveInject(i5.MatDialog), i0.ɵɵdirectiveInject(i6.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        standalone: false,\n        decls: 7,\n        vars: 10,\n        consts: [[\"elseTemplate\", \"\"], [1, \"\"], [\"style\", \"background: green; color: white; padding: 5px; text-align: center;\", 4, \"ngIf\"], [\"color\", \"secondary\", \"class\", \"header shadow-sm\", 4, \"ngIf\"], [1, \"app\", 3, \"ngClass\"], [1, \"container\", 3, \"ngClass\"], [\"class\", \"footer\", 4, \"ngIf\"], [2, \"background\", \"green\", \"color\", \"white\", \"padding\", \"5px\", \"text-align\", \"center\"], [\"color\", \"secondary\", 1, \"header\", \"shadow-sm\"], [1, \"nav-links\"], [\"src\", \"/static/assets/favicon/apple-touch-icon.png\", \"alt\", \"Icon\", \"height\", \"30\", \"width\", \"30\"], [\"mat-flat-button\", \"\", 1, \"font-bold\", \"color-primary\", \"navbar-brand\", 2, \"text-decoration\", \"none\", 3, \"routerLink\"], [4, \"ngIf\"], [1, \"search-bar\"], [1, \"navbar-item-search\", 3, \"ngSubmit\", \"formGroup\"], [\"mat-icon-button\", \"\", 1, \"search-icon-wrapper\"], [1, \"search-icon\"], [\"formControlName\", \"search\", \"placeholder\", \"Search\", \"name\", \"search\", \"oninput\", \"this.value = this.value.toLowerCase()\", 1, \"search-input\"], [4, \"ngIf\", \"ngIfElse\"], [\"mat-flat-button\", \"\", 1, \"color-tertiary\", 3, \"routerLink\"], [\"mat-flat-button\", \"\", 1, \"color-tertiary\", 3, \"click\"], [\"class\", \"buttons-section nav-links\", 4, \"ngIf\"], [1, \"buttons-section\", \"nav-links\"], [\"mat-icon-button\", \"\", 3, \"routerLink\"], [2, \"vertical-align\", \"middle\", \"font-size\", \"16px\"], [\"mat-icon-button\", \"\", \"aria-label\", \"Logout\", 1, \"logout-icon\", 3, \"click\"], [1, \"buttons-section\"], [\"mat-button\", \"\", 3, \"routerLink\"], [1, \"footer\"], [\"href\", \"https://github.com/adampzb/discussit\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 1);\n            i0.ɵɵtemplate(1, AppComponent_div_1_Template, 2, 2, \"div\", 2)(2, AppComponent_mat_toolbar_2_Template, 15, 6, \"mat-toolbar\", 3);\n            i0.ɵɵelementStart(3, \"main\", 4)(4, \"div\", 5);\n            i0.ɵɵelement(5, \"router-outlet\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(6, AppComponent_footer_6_Template, 4, 0, \"footer\", 6);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.authRoute);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.authRoute);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(5, _c0, !ctx.authRoute, !ctx.authRoute));\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c1, ctx.authRoute));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", !ctx.authRoute);\n          }\n        },\n        dependencies: [i7.NgClass, i7.NgIf, i8.ɵNgNoValidate, i8.DefaultValueAccessor, i8.NgControlStatus, i8.NgControlStatusGroup, i8.FormGroupDirective, i8.FormControlName, i9.MatButton, i9.MatIconButton, i10.MatIcon, i11.MatToolbar, i1.RouterOutlet, i1.RouterLink],\n        styles: [\".navbar-brand[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.sidenav[_ngcontent-%COMP%]{background:#fff;float:left;width:260px;position:fixed;top:64px;border-width:0 1px 1px 0;border-style:solid;border-color:#e6e6e6;height:100vh;z-index:1;overflow:hidden}.navbar-item-search[_ngcontent-%COMP%]{width:100%}.app-main[_ngcontent-%COMP%]{padding-top:56px}.header[_ngcontent-%COMP%]{justify-content:space-between;background-color:#fff;z-index:14;position:fixed;height:56px!important}.bg-container[_ngcontent-%COMP%]{background-color:#f5f5f5}.bg-white[_ngcontent-%COMP%]{background-color:#fff}.container[_ngcontent-%COMP%]{min-height:calc(100vh - 56px);width:auto;overflow-x:hidden;padding:32px;max-width:1200px;margin:auto}.unauth-container[_ngcontent-%COMP%]{min-height:100vh;max-width:100%;width:100%;padding:0}.search-bar[_ngcontent-%COMP%]{border:1px solid #DC281E;border-radius:25px;width:100%;max-width:500px;font-family:Roboto,sans-serif;font-size:.75rem;box-sizing:border-box;font-weight:300;display:flex}.search-bar[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{padding:4px 0 0 8px;color:#707070;font-size:20px}.search-bar[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{outline:none;border:none;background:transparent;width:100%}.search-bar[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::placeholder{font-family:Roboto,sans-serif;color:#707070;font-weight:300}@media only screen and (max-width:720px){.search-bar[_ngcontent-%COMP%]{display:none}}.nav-links[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.footer[_ngcontent-%COMP%]{padding:8px 16px;color:#232323;font-weight:300;text-align:center;font-size:14px}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}